<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HeyGen Player Embed</title>
  <style>
    body { margin:0; background:#000; color:#0f0; font:14px monospace; }
    #log { padding:8px; white-space:pre-wrap; }
    #controls { padding:8px; }
    button { margin:4px; padding:6px 10px; }
  </style>
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
</head>
<body>
  <div id="log">[player-embed] Bootingâ€¦</div>
  <div id="controls">
    <button id="startBtn">â–¶ï¸ Start</button>
    <button id="stopBtn">â¹ Stop</button>
    <button id="muteBtn">ğŸ”‡ Mute</button>
    <button id="unmuteBtn">ğŸ”Š Unmute</button>
  </div>
  <script>
    const log = (msg, obj) => {
      const line = typeof obj !== "undefined" ? msg + " " + JSON.stringify(obj) : msg;
      console.log(line);
      document.getElementById("log").innerText += "\n" + line;
    };

    let player = null;
    let lastData = null;

    // Listen for parent (Wix page) messages
    window.addEventListener("message", (ev) => {
      if (!ev.data) return;
      log("ğŸ“© parent said:", ev.data);

      const { token, sessionId, avatarId, kbId } = ev.data;
      if (!token || !sessionId) {
        log("âŒ missing required data", ev.data);
        return;
      }

      lastData = { token, sessionId, avatarId, kbId };

      if (window.HeyGenPlayer) {
        log("ğŸ›  creating player with HeyGenPlayer.createâ€¦");
        player = window.HeyGenPlayer.create(lastData);
        log("ğŸ‰ player created:", player);
      } else {
        log("âŒ HeyGenPlayer not available on window");
      }
    });

    // Controls
    document.getElementById("startBtn").onclick = async () => {
      if (!player || !lastData) return log("âš ï¸ no player yet, wait for parent message.");
      try {
        log("ğŸš€ starting avatar streamâ€¦", lastData);
        await player.startAvatar(lastData);
        log("âœ… avatar started");
      } catch (e) {
        log("âŒ startAvatar failed:", e);
      }
    };

    document.getElementById("stopBtn").onclick = async () => {
      if (!player) return;
      try {
        await player.stopAvatar();
        log("â¹ avatar stopped");
      } catch (e) {
        log("âŒ stop failed:", e);
      }
    };

    document.getElementById("muteBtn").onclick = async () => {
      if (!player) return;
      try {
        await player.muteMicrophone();
        log("ğŸ”‡ mic muted");
      } catch (e) {
        log("âŒ mute failed:", e);
      }
    };

    document.getElementById("unmuteBtn").onclick = async () => {
      if (!player) return;
      try {
        await player.unmuteMicrophone();
        log("ğŸ”Š mic unmuted");
      } catch (e) {
        log("âŒ unmute failed:", e);
      }
    };
  </script>
</body>
</html>
