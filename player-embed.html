<script>
window.addEventListener("message", async (event) => {
  const { token, avatarId, kbId } = event.data || {};
  console.log("[player-embed] ğŸ“© parent said:", event.data);

  if (!token || !avatarId) {
    console.error("[player-embed] âŒ missing required data", event.data);
    return;
  }

  console.log("[player-embed] ğŸ›  creating player with HeyGenPlayer.createâ€¦");

  try {
    const player = await HeyGenPlayer.create({
      token: token
    });
    console.log("[player-embed] ğŸ‰ player created:", player);

    // Start avatar stream
    console.log("[player-embed] ğŸš€ starting avatar streamâ€¦", { token, avatarId, kbId });
    await player.startAvatar({
      token: token,
      avatarName: avatarId,
      knowledgeBaseId: kbId
    });

    console.log("[player-embed] âœ… avatar started");
  } catch (err) {
    console.error("[player-embed] âŒ startAvatar failed:", err);
  }
});
</script>
