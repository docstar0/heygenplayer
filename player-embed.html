<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>HeyGen Player Embed</title>
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
  <style>
    body { margin: 0; background: black; }
    #playerContainer { width: 100%; height: 100%; position: relative; }
    #controls { position: absolute; bottom: 10px; left: 10px; z-index: 10; }
  </style>
</head>
<body>
  <div id="playerContainer"></div>
  <div id="controls">
    <button id="startBtn">â–¶ Start</button>
    <button id="stopBtn">â¹ Stop</button>
    <button id="muteBtn">ğŸ”‡ Mute</button>
    <button id="unmuteBtn">ğŸ”Š Unmute</button>
  </div>

  <script>
    console.log("[player-embed] Bootingâ€¦");

    let player;
    window.addEventListener("message", async (event) => {
      const { token, sessionId, avatarId } = event.data || {};
      console.log("ğŸ“© parent said:", event.data);

      if (!token || !sessionId || !avatarId) {
        console.error("âŒ missing required data", event.data);
        return;
      }

      console.log("ğŸ›  creating player with HeyGenPlayer.createâ€¦");
      player = await HeyGenPlayer.create({
        token,
        sessionId,
        avatarName: avatarId,
        container: document.getElementById("playerContainer"),
      });

      console.log("ğŸ‰ player created:", player);

      // Wire up controls
      document.getElementById("startBtn").onclick = async () => {
        try {
          console.log("ğŸš€ starting avatar streamâ€¦", { token, sessionId, avatarId });
          await player.startAvatar({ token, sessionId, avatarName: avatarId });
          console.log("âœ… avatar started");
        } catch (err) {
          console.error("âŒ startAvatar failed:", err);
        }
      };

      document.getElementById("stopBtn").onclick = async () => {
        try {
          await player.stopAvatar();
          console.log("ğŸ›‘ avatar stopped");
        } catch (err) {
          console.error("âŒ stopAvatar failed:", err);
        }
      };

      document.getElementById("muteBtn").onclick = () => player.muteMicrophone?.();
      document.getElementById("unmuteBtn").onclick = () => player.unmuteMicrophone?.();
    });
  </script>
</body>
</html>
