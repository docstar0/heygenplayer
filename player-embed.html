<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeyGen Player Embed</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: #9ee;
      font-family: system-ui, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #player {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }
  </style>
  <!-- Load your bundled HeyGen player -->
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
</head>
<body>
  <div id="player">‚è≥ Loading avatar‚Ä¶</div>

  <script>
    console.log("[player-embed] booting‚Ä¶");

    // Listen for messages from Wix CE/page code
    window.addEventListener("message", (event) => {
      console.log("[player-embed] üì© got message from Wix:", event.data);

      const { token, avatarId, kbId } = event.data || {};
      if (!token || !avatarId) {
        console.error("[player-embed] ‚ùå Missing token or avatarId");
        return;
      }

      if (!window.HeyGenPlayer) {
        console.error("[player-embed] ‚ùå HeyGenPlayer not loaded");
        return;
      }

      // Clear loading text
      const container = document.getElementById("player");
      container.innerHTML = "";

      try {
        const player = window.HeyGenPlayer.create({
          token,
          avatarId,
          knowledgeBaseId: kbId,
          container,
          autoplay: true,
          debug: true,
        });
        console.log("[player-embed] ‚úÖ initialized HeyGenPlayer", { avatarId, kbId });
      } catch (err) {
        console.error("[player-embed] ‚ùå failed to init HeyGenPlayer:", err);
        container.innerHTML = "<div style='color:#f88'>‚ùå Failed to load avatar</div>";
      }
    });
  </script>
</body>
</html>
