<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>HeyGen Player Embed</title>
    <style>
      body {
        margin: 0;
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #playerBox {
        width: 640px;
        height: 480px;
        background: #000;
      }
    </style>
    <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
  </head>
  <body>
    <div id="playerBox"></div>
    <button id="startBtn">Start Avatar</button>

    <script>
      console.log("[player-embed] Booting…");

      window.addEventListener("message", async (event) => {
        if (!event.data || !event.data.token) return;

        console.log("📩 parent said:", event.data);

        try {
          const { token, avatarId, kbId } = event.data;

          console.log("🛠 creating player with HeyGenPlayer.create…");
          const player = await window.HeyGenPlayer.create({
            token,
            avatarId,
            container: document.getElementById("playerBox"),
          });

          console.log("🎉 player created:", player);

          document.getElementById("startBtn").onclick = async () => {
            console.log("🚀 sending task to avatar…", { token, avatarId });

            try {
              await player.startTask({
                taskType: "talk",
                text: "Hello, world! The player is working.",
                voice: "Jenny", // must be a valid HeyGen voice
              });
              console.log("✅ task sent to avatar");
            } catch (err) {
              console.error("❌ startTask failed:", err);
            }
          };
        } catch (err) {
          console.error("❌ failed to init:", err);
        }
      });
    </script>
  </body>
</html>
