<script>
  console.log("[player-embed] booting…");

  window.addEventListener("message", (event) => {
    console.log("[player-embed] 📩 got message from Wix:", event.data);

    const { token, avatarId, kbId } = event.data || {};
    if (!token || !avatarId) {
      console.error("[player-embed] ❌ Missing token or avatarId");
      return;
    }

    if (!window.HeyGenPlayer) {
      console.error("[player-embed] ❌ HeyGenPlayer not loaded");
      return;
    }

    // Create the player inside this iframe
    const container = document.getElementById("player") || document.body;
    container.innerHTML = ""; // clear loading text

    const player = window.HeyGenPlayer.create({
      token,
      avatarId,
      knowledgeBaseId: kbId,
      container,
      // optional config
      autoplay: true,
      debug: true,
    });

    console.log("[player-embed] ✅ initialized HeyGenPlayer", { avatarId, kbId });
  });
</script>
