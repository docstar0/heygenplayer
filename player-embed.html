<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeyGen Player Debug</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #0f0;
      font-family: monospace;
    }
    #player-root {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    #heygen-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #000;
    }
  </style>
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
</head>
<body>
  <div id="player-root">
    <video id="heygen-video" autoplay playsinline muted></video>
  </div>

  <script>
    console.log("[player-embed] Bootingâ€¦");

    window.addEventListener("message", async (event) => {
      const { token, avatarId, kbId } = event.data || {};
      if (!token || !avatarId) {
        console.error("[player-embed] âŒ Missing token or avatarId", event.data);
        return;
      }

      console.log("[player-embed] ğŸ“© parent said:", event.data);

      try {
        console.log("[player-embed] ğŸ›  creating player with HeyGenPlayer.createâ€¦");
        const player = await window.HeyGenPlayer.create({
          token,
          avatarId,
          kbId,
        });

        console.log("[player-embed] ğŸ‰ player created:", player);

        // Attach media stream to <video>
        const videoEl = document.getElementById("heygen-video");
        if (player.mediaStream && videoEl) {
          videoEl.srcObject = player.mediaStream;
          console.log("[player-embed] âœ… attached mediaStream to <video>");
        } else {
          console.error("[player-embed] âŒ No mediaStream available", player);
        }

      } catch (err) {
        console.error("[player-embed] âŒ exception during create:", err);
      }
    });
  </script>
</body>
</html>
