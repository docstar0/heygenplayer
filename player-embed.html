<script>
window.addEventListener("message", async (event) => {
  const { token, avatarId, kbId } = event.data || {};
  console.log("[player-embed] 📩 parent said:", event.data);

  if (!token || !avatarId) {
    console.error("[player-embed] ❌ missing required data", event.data);
    return;
  }

  console.log("[player-embed] 🛠 creating player with HeyGenPlayer.create…");

  try {
    const player = await HeyGenPlayer.create({
      token: token
    });
    console.log("[player-embed] 🎉 player created:", player);

    // Start avatar stream
    console.log("[player-embed] 🚀 starting avatar stream…", { token, avatarId, kbId });
    await player.startAvatar({
      token: token,
      avatarName: avatarId,
      knowledgeBaseId: kbId
    });

    console.log("[player-embed] ✅ avatar started");
  } catch (err) {
    console.error("[player-embed] ❌ startAvatar failed:", err);
  }
});
</script>
