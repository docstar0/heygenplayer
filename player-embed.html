window.addEventListener("message", (event) => {
  const { token, sessionId, avatarId, kbId } = event.data || {};
  console.log("[player-embed] 📩 parent said:", event.data);

  if (token && avatarId && sessionId) {
    console.log("[player-embed] 🛠 creating player with HeyGenPlayer.create…");

    const player = window.HeyGenPlayer.create({
      token,
      sessionId,
      avatarId,
      kbId,
      container: document.getElementById("player"),
    });

    console.log("[player-embed] 🎉 player created:", player);

    // Attach controls
    document.getElementById("startBtn").onclick = () => {
      console.log("[player-embed] 🚀 starting avatar stream…");
      player.startAvatar().catch(err => console.error("[player-embed] ❌ startAvatar failed:", err));
    };

    document.getElementById("stopBtn").onclick = () => {
      console.log("[player-embed] ⏹ stopping avatar…");
      player.stopAvatar().catch(err => console.error("[player-embed] ❌ stopAvatar failed:", err));
    };

    document.getElementById("muteBtn").onclick = () => player.muteMic();
    document.getElementById("unmuteBtn").onclick = () => player.unmuteMic();
  }
});
