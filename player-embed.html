<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeyGen Player Debug</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
      color: #0f0;
      font-family: monospace;
    }
    #log {
      position: absolute;
      top: 0;
      left: 0;
      padding: 6px;
      font-size: 12px;
      white-space: pre-line;
    }
  </style>
  <!-- Load the HeyGen UMD build -->
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
</head>
<body>
  <div id="player-container"></div>
  <div id="log"></div>

  <script>
    function log(msg) {
      console.log(msg);
      const el = document.getElementById("log");
      el.textContent += msg + "\n";
    }

    log("[player-embed] booting‚Ä¶");

    if (!window.HeyGenPlayer) {
      log("‚ùå HeyGenPlayer missing from window");
    } else {
      log("‚úÖ HeyGenPlayer available");
    }

    // Wait for Wix page to send init message
    window.addEventListener("message", (evt) => {
      if (evt.data?.type === "init") {
        const { token, avatarId, kbId } = evt.data.payload || {};
        log("üì© received init message: " + JSON.stringify(evt.data.payload));

        if (!token || !avatarId) {
          log("‚ùå Missing token or avatarId");
          return;
        }

        // Clear container
        const container = document.getElementById("player-container");
        container.innerHTML = "";

        try {
          // Boot HeyGen player
          const player = window.HeyGenPlayer.create({
            el: container,
            token,
            avatarId,
            kbId,
          });
          log("‚úÖ HeyGenPlayer created");
        } catch (err) {
          log("‚ùå Failed to create HeyGenPlayer: " + err.message);
        }
      }
    });
  </script>
</body>
</html>
