<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeyGen Player Embed</title>
  <style>
    body { margin:0; background:#000; color:#0f0; font:14px monospace; }
    #log { padding:8px; white-space:pre-wrap; max-height:150px; overflow:auto; }
    #playerBox { width:100%; height:400px; background:#111; }
    #controls { padding:8px; background:#222; }
    button { margin:4px; padding:6px 10px; font-size:14px; }
  </style>
</head>
<body>
  <div id="playerBox">â³ Loading HeyGen playerâ€¦</div>
  <div id="controls">
    <button id="startBtn">â–¶ï¸ Start</button>
    <button id="stopBtn">â¹ Stop</button>
    <button id="muteBtn">ğŸ”‡ Mute</button>
    <button id="unmuteBtn">ğŸ”Š Unmute</button>
  </div>
  <div id="log"></div>

  <!-- Load HeyGen UMD -->
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
  <script>
    const log = (...args) => {
      console.log("[player-embed]", ...args);
      document.getElementById("log").textContent += args.map(a =>
        typeof a === "object" ? JSON.stringify(a) : String(a)
      ).join(" ") + "\n";
    };

    let player = null;

    window.addEventListener("message", (evt) => {
      const { token, sessionId, avatarId, kbId } = evt.data || {};
      log("ğŸ“© parent said:", evt.data);

      if (!token || !sessionId || !avatarId) {
        log("âŒ missing required data", evt.data);
        return;
      }

      try {
        player = window.HeyGenPlayer.create({
          token,
          session_id: sessionId,   // âœ… must include
          avatarId,
          kbId,
          container: document.getElementById("playerBox"),
        });
        log("ğŸ‰ player created:", player);
      } catch (e) {
        log("âŒ exception during create:", e);
      }
    });

    // Controls
    document.getElementById("startBtn").onclick = async () => {
      if (!player) return log("âš ï¸ no player yet");
      try {
        log("ğŸš€ starting avatar streamâ€¦");
        await player.startAvatar();
        log("âœ… avatar started");
      } catch (err) {
        log("âŒ startAvatar failed:", err);
      }
    };

    document.getElementById("stopBtn").onclick = async () => {
      if (!player) return log("âš ï¸ no player yet");
      try {
        await player.stopAvatar();
        log("ğŸ›‘ avatar stopped");
      } catch (err) {
        log("âŒ stopAvatar failed:", err);
      }
    };

    document.getElementById("muteBtn").onclick = async () => {
      if (!player) return log("âš ï¸ no player yet");
      try {
        await player.mute();
        log("ğŸ”‡ avatar muted");
      } catch (err) {
        log("âŒ mute failed:", err);
      }
    };

    document.getElementById("unmuteBtn").onclick = async () => {
      if (!player) return log("âš ï¸ no player yet");
      try {
        await player.unmute();
        log("ğŸ”Š avatar unmuted");
      } catch (err) {
        log("âŒ unmute failed:", err);
      }
    };
  </script>
</body>
</html>
