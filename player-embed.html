<script>
console.log("[player-embed] Bootingâ€¦");

// Wait for parent messages
window.addEventListener("message", async (evt) => {
  console.log("[player-embed] ğŸ“© parent said:", evt.data);
  const { token, avatarId, kbId } = evt.data || {};
  if (!token || !avatarId) return;

  console.log("[player-embed] ğŸ›  creating player with HeyGenPlayer.createâ€¦", { token, avatarId, kbId });
  const player = window.HeyGenPlayer.create({
    token,
    avatarId,
    knowledgeBaseId: kbId,
    container: document.getElementById("playerBox"),
  });

  console.log("[player-embed] ğŸ‰ player created:", player);

  // Add a manual start button
  const btn = document.createElement("button");
  btn.textContent = "â–¶ Start Avatar";
  btn.style.cssText = "position:absolute;top:10px;left:10px;z-index:1000;";
  btn.onclick = async () => {
    console.log("[player-embed] ğŸš€ user clicked start, starting avatar streamâ€¦");
    try {
      if (typeof player.createStartAvatar === "function") {
        await player.createStartAvatar({});
      } else if (typeof player.startAvatar === "function") {
        await player.startAvatar();
      }
      console.log("[player-embed] âœ… avatar started");
    } catch (err) {
      console.error("[player-embed] âŒ failed to start avatar:", err);
    }
  };
  document.body.appendChild(btn);
});
</script>
