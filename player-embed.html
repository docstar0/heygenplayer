window.addEventListener("message", (event) => {
  const { token, sessionId, avatarId, kbId } = event.data || {};
  console.log("[player-embed] ğŸ“© parent said:", event.data);

  if (token && avatarId && sessionId) {
    console.log("[player-embed] ğŸ›  creating player with HeyGenPlayer.createâ€¦");

    const player = window.HeyGenPlayer.create({
      token,
      sessionId,
      avatarId,
      kbId,
      container: document.getElementById("player"),
    });

    console.log("[player-embed] ğŸ‰ player created:", player);

    // Attach controls
    document.getElementById("startBtn").onclick = () => {
      console.log("[player-embed] ğŸš€ starting avatar streamâ€¦");
      player.startAvatar().catch(err => console.error("[player-embed] âŒ startAvatar failed:", err));
    };

    document.getElementById("stopBtn").onclick = () => {
      console.log("[player-embed] â¹ stopping avatarâ€¦");
      player.stopAvatar().catch(err => console.error("[player-embed] âŒ stopAvatar failed:", err));
    };

    document.getElementById("muteBtn").onclick = () => player.muteMic();
    document.getElementById("unmuteBtn").onclick = () => player.unmuteMic();
  }
});
