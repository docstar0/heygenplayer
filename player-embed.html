<script>
window.addEventListener("message", async (event) => {
  const { token, avatarId } = event.data || {};
  console.log("[player-embed] ğŸ“© parent said:", event.data);

  if (!token || !avatarId) {
    console.error("[player-embed] âŒ missing required data", event.data);
    return;
  }

  try {
    console.log("[player-embed] ğŸ›  creating player with HeyGenPlayer.createâ€¦");

    const player = await HeyGenPlayer.create({ token });
    console.log("[player-embed] ğŸ‰ player created:", player);

    // Add a button so browser allows audio/video
    const btn = document.createElement("button");
    btn.textContent = "â–¶ï¸ Start Avatar";
    btn.style.padding = "10px";
    btn.onclick = async () => {
      try {
        console.log("[player-embed] ğŸš€ starting avatar streamâ€¦", { avatarId });
        await player.startAvatar({ token, avatarName: avatarId });
        console.log("[player-embed] âœ… avatar started");
      } catch (err) {
        console.error("[player-embed] âŒ startAvatar failed:", err);
      }
    };
    document.body.appendChild(btn);

  } catch (err) {
    console.error("[player-embed] âŒ failed to init player:", err);
  }
});
</script>
