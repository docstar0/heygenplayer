<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HeyGen Player Debug</title>
  <style>
    body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; }
    #player { width: 100%; height: 100%; background: #000; }
  </style>
  <script src="https://docstar0.github.io/heygenplayer/heygen-player.umd.js"></script>
</head>
<body>
  <div id="player">‚è≥ Loading avatar‚Ä¶</div>

  <script>
    console.log("[player-embed] booting‚Ä¶");

    // Listen for Wix ‚Üí iframe messages
    window.addEventListener("message", async (event) => {
      console.log("[player-embed] üì© received payload", event.data);

      const { token, avatarId, kbId } = event.data || {};
      if (!token || !avatarId) {
        console.error("[player-embed] ‚ùå Missing token/avatarId");
        return;
      }

      try {
        console.log("[player-embed] ‚úÖ starting HeyGenPlayer", { avatarId, kbId });

        const player = window.HeyGenPlayer.create({
          token,
          avatarId,
          knowledgeBaseId: kbId,
          container: document.getElementById("player")
        });

        player.on("ready", () => {
          console.log("[player-embed] üéâ Avatar ready!");
          // üëá Auto-play test speech so you can SEE it works
          player.speakText("Hello! The HeyGen avatar is now running inside Wix.");
        });

        player.on("error", (err) => {
          console.error("[player-embed] ‚ùå Player error:", err);
        });

      } catch (e) {
        console.error("[player-embed] ‚ùå Fatal init error:", e);
      }
    });
  </script>
</body>
</html>
